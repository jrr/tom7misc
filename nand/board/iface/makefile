default : nandy.exe
all : testnand.exe nandy.exe piface.exe


CXXFLAGS=-Wall -Wno-sign-compare -Wno-deprecated-declarations -O2 --std=c++14 -I ../../../cc-lib   -I ../../../cc-lib/pi

# XXX for windows
PLATFORMCFLAGS= -D__MINGW32__ -DHAVE_ALLOCA  -D_WIN32_WINNT=0x0602 -D_GLIBCXX_HAS_GTHREADS -mthreads
PLATFORMLINK=-Wl,--subsystem,console -L.
CXX=x86_64-w64-mingw32-g++
CC=x86_64-w64-mingw32-gcc


CPPFLAGS=-m64 $(INCLUDES) $(PLATFORMCFLAGS) $(SYMBOLS)
LFLAGS=-m64 -mthreads -lwinpthread -lpsapi -static $(PLATFORMLINK)

%.o : %.cc *.h
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c -o $@ $<
#	bash -c "echo -n '.'"

%.s : %.cc
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -S -c -o $@ $<

CCLIB_OBJECTS= ../../../cc-lib/base/logging.o ../../../cc-lib/stb_image.o  ../../../cc-lib/arcfour.o ../../../cc-lib/util.o ../../../cc-lib/color-util.o ../../../cc-lib/base/stringprintf.o
ALL_CCLIB_OBJECTS=$(CCLIB_OBJECTS) ../../../cc-lib/stb_image_write.o ../../../cc-lib/image.o ../../../cc-lib/md5.o

CCLIB_PI_OBJECTS=../../../cc-lib/pi/bcm2835.o

testnand.exe : testnand.o $(CCLIB_PI_OBJECTS) $(CCLIB_OBJECTS)
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) $^ -o $@ $(LFLAGS)

nandy.exe : nandy.o $(ALL_CCLIB_OBJECTS)
	$(CXX) $^ -o $@ $(LFLAGS)

piface.exe : piface.o $(CCLIB_PI_OBJECTS) $(CCLIB_OBJECTS)
	$(CXX) $(CXXFLAGS) $^ -o $@ $(LFLAGS)

clean :
	rm -f *.o *.exe core $(ALL_CCLIB_OBJECTS) $(CCLIB_PI_OBJECTS) $(FCEULIB_OBJECTS)

veryclean : clean
	rm -f *~
