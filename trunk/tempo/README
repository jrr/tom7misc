This is a simple custom household temperature probe ensemble.
Probably not that useful for others, but code is GPL (see COPYING).


Local database server notes:

Set router to only DHCP in 10.0.0.2 - 10.0.0.200.
Set desktop computer to static IP e.g. 10.0.0.202 (check with ipconfig).
(In Windows 10, do this from "change adapter options", properties,
 then Internet Protocol Version 4 Properties.)

The windows mysql installer is 32 bit but can install 64 bit.
Server-only installation still comes with command-line client, so this
is all you need.

Set up windows MySQL on port 3306, not open to internet
(this seems to be the default without manual intervention).

create database tempo;
create user tempo@'10.0.0.%' identified by 'PASSWORD';
grant insert on tempo.* to 'tempo'@'10.0.0.%';
grant update on tempo.* to 'tempo'@'10.0.0.%';
grant select on tempo.* to 'tempo'@'10.0.0.%';
grant delete on tempo.* to 'tempo'@'10.0.0.%';
(Also create the tables in database.txt)

You can change the storage location (etc.) in
c:\programdata\mysql\mysql server 8.0\my.ini
(Move the Data directory itself to the new location too!)

On the pi:

Write latest raspbian lite to microsd card.
On the boot partition:

Add onewire support in /boot/config.txt:
dtoverlay=w1-gpio,gpiopin=17

Turn on console too for debugging:
(probably not actually necessary)
enable_uart=1

Add a file just called 'ssh' to enable ssh on the next boot.

You also need to configure wifi by creating a file called
wpa_supplicant.conf:
country=US
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1
network={
  ssid="famicom"
  psk="PASSWORD-HERE"
}

Boot. Check the router to find what IP address is assigned by DHCP (or
scan, I guess). Raspberry pi starts with user "pi" and password
"raspberry". Change it!

sudo raspi-config
 - Set locale to en_US.UTF-8
 - Enable ssh (under "interfacing options")
 - Advanced: Expand filesystem
 - Boot options: Wait for network (?I think this is a good idea?)
(reboot?)

sudo apt-get update
sudo apt-get dist-upgrade
sudo apt-get autoclean

# these don't work any more?
# sudo apt-get install default-libmysqlclient-dev libmysql++-dev
# sudo apt-get install default-libmariaclient-dev libmaria++-dev

sudo apt-get install subversion emacs-nox libmariadb-dev-compat mariadb-client dos2unix

You should be able to connect using the command line client:
mysql -u tempo -p -h 10.0.0.202


svn co --username tom7 https://svn.code.sf.net/p/tom7misc/svn/trunk tom7misc
(just cc-lib and tempo should be needed, but might as well back up all source
code on every microsd card!)

Create the file database-config.txt:
server 10.0.0.202  (?? CHECK)
user tempo
password PASSWORD


Wifi troubleshooting:
  Looks like if the pi boots before the wireless router, it may come
  up without internet and stay that way. Should probably periodically
  do something like:
  sudo ifconfig wlan0 down && sleep 2 && sudo ifconfig wlan0 up && sleep 5
  (or maybe just reboot)
  (There is "wait for internet" boot option in raspi-config which may
   address this.)


Note that mysql support now seems to come via the "maria db"
non-Oracle fork of MySQL.


mysql++ is separate project from both mysql and maria, so it does not
have a "maria version". In 2020 I couldn't find the ubuntu package to
install, so I installed from source...

cd /usr/src
wget https://tangentsoft.com/mysqlpp/releases/mysql++-3.2.5.tar.gz
./configure --prefix=/usr
make -j 2
sudo make install


To create the SVG diagram in Illustrator:
 - Layer names yield <g id="abc"> with the SVG export option enabled. Use a-z.
   CSS selectors like #abc path { fill: #F00 !important } are used to set the
   path colors from temp readings.
 - If you get <tspan> elements in text this will interfere with substitution.
   I switched to SansSerif font (from Myriad Pro) and set kerning to 0 instead
   of Auto in Character panel, which seemed to help.
   
